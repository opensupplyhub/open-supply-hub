{
  "image": "${image_url}",
  "vcpus": 1,
  "memory": 2048,
  "command": [
    "python",
    "manage.py",
    "sync_databases",
    "--source-host", "${source_db_host}",
    "--source-port", "${source_db_port}",
    "--source-name", "${source_db_name}",
    "--source-user", "${source_db_user}",
    "--source-password", "${source_db_password}",
    "--chunk-size", "${chunk_size}",
    "--last-run-path", "/db-sync"
  ],
  "environment": [
      { "name": "AWS_DEFAULT_REGION", "value": "${aws_region}" },
      { "name": "AWS_STORAGE_BUCKET_NAME", "value": "${aws_storage_bucket_name}" },
      { "name": "POSTGRES_HOST", "value": "${postgres_host}" },
      { "name": "POSTGRES_PORT", "value": "${postgres_port}" },
      { "name": "POSTGRES_USER", "value": "${postgres_user}" },
      { "name": "POSTGRES_PASSWORD", "value": "${postgres_password}" },
      { "name": "POSTGRES_DB", "value": "${postgres_db}" },
      { "name": "DJANGO_SETTINGS_MODULE", "value": "oar.settings" },
      { "name": "DEFAULT_FILE_STORAGE", "value": "storages.backends.s3boto3.S3Boto3Storage" },
      { "name": "DJANGO_ENV", "value": "${environment}" },
      { "name": "BATCH_JOB_QUEUE_NAME", "value": "${batch_job_queue_name}" },
      { "name": "BATCH_JOB_DEF_NAME", "value": "${batch_job_def_name}" },
      { "name": "BATCH_MODE", "value": "True" },
      { "name": "DJANGO_SECRET_KEY", "value": "${django_secret_key}" },
      { "name": "GOOGLE_SERVER_SIDE_API_KEY", "value": "${google_server_side_api_key}" },
      { "name": "OAR_CLIENT_KEY", "value": "${oar_client_key}" },
      { "name": "EXTERNAL_DOMAIN", "value": "${external_domain}" },
      { "name": "INSTANCE_SOURCE", "value": "${instance_source}" },
      { "name": "EMAIL_ANONYMIZATION_SECRET", "value": "${email_anonymization_secret}" },
      { "name": "DJANGO_LOG_LEVEL", "value": "INFO" },
      { "name": "PYTHONUNBUFFERED", "value": "1" },
      { "name": "TZ", "value": "UTC" }
  ],
  "mountPoints": [
      {
          "containerPath": "/db-sync",
          "sourceVolume": "efs-db-sync-storage"
      }
  ],
  "volumes": [
      {
          "name": "efs-db-sync-storage",
          "efsVolumeConfiguration": {
              "fileSystemId": "${efs_file_system_id}",
              "rootDirectory": "/",
              "transitEncryption": "ENABLED",
              "authorizationConfig": {
                  "accessPointId": "${efs_access_point_id}"
              }
          }
      }
  ],
  "logConfiguration": {
      "logDriver": "awslogs",
      "options": {
          "awslogs-group": "${log_group_name}",
          "awslogs-region": "${aws_region}",
          "awslogs-stream-prefix": "db-sync",
          "awslogs-datetime-format": "%Y-%m-%d %H:%M:%S"
      }
  },
  "ulimits": [
      {
          "name": "nofile",
          "softLimit": 65536,
          "hardLimit": 65536
      }
  ],
  "user": "1000:0"
}
